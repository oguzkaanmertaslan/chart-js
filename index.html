<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chart</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
      crossorigin="anonymous"
    />
  </head>
  <body class="bg-success">
    <div class="col-8 offset-2 my-5">
      <div class="card">
        <div class="card-body">
          <label>Start:</label>
          <input type="text" id="start" />
          <label>End:</label>
          <input type="text" id="end" />
          <button type="button" onclick="searchData()">Search</button>
          Chart
          <hr />
          <canvas id="dynamic-chart" width="400" height="400"></canvas>
          <hr />
          <button class="btn btn-success" id="line">Line Chart</button>
          <button class="btn btn-success" id="bar">Bar Chart</button>
          <button class="btn btn-success" id="bubble">Bubble Chart</button>
          <button class="btn btn-success" id="pie">Pie Chart</button>
          <button class="btn btn-success" id="doughnut">Doughnut Chart</button>
          <button class="btn btn-success" id="polar">Polar Chart</button>
          <button class="btn btn-success" id="radar">Radar Chart</button>
        </div>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
      crossorigin="anonymous"
    ></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const line = document.getElementById("line");
      const bar = document.getElementById("bar");
      const bubble = document.getElementById("bubble");
      const pie = document.getElementById("pie");
      const doughnut = document.getElementById("doughnut");
      const polar = document.getElementById("polar");
      const radar = document.getElementById("radar");

      line.addEventListener("click", changeLine);
      bar.addEventListener("click", changeBar);
      bubble.addEventListener("click", changeBubble);
      pie.addEventListener("click", changePie);
      doughnut.addEventListener("click", changeDoughnut);
      polar.addEventListener("click", changePolar);
      radar.addEventListener("click", changeRadar);

      const ctx = document.getElementById("dynamic-chart").getContext("2d");

      let fetchData = fetch("chart.json").then(
        async (response) =>
          await response.json().then((item) => {
            dataX = item.x.splice(0, 100);
            dataY = item.y.splice(0, 100);
            dataZ = item.z.splice(0, 100);

            handlex = item.x.filter((item) => item > 1);

            let values = [];
            for (let i = 0; i < dataX.length; i++) {
              values.push(dataX[i]);
            }
            myChart.data.labels = values;
            myChart.data.datasets[0].data = dataX;
            myChart.data.datasets[1].data = dataY;
            myChart.data.datasets[2].data = dataZ;
            myChart.update();
          })
      );

      const searchData = () => {
        let start = document.getElementById("start").value;
        let end = document.getElementById("end").value;
        document.getElementById("start").innerHTML = start;
        document.getElementById("end").innerHTML = end;
        const newDataX = dataX.filter((item, index) => {
          return item > start && item < end;
        });
        const newDataY = dataY.filter((item, index) => {
          return item > start && item < end;
        });
        const newDataZ = dataZ.filter((item, index) => {
          return item > start && item < end;
        });

        myChart.data.datasets[0].data = newDataX;
        myChart.data.datasets[1].data = newDataY;
        myChart.data.datasets[2].data = newDataZ;

        myChart.update();
      };

      const myChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            {
              label: "X",
              data: [],
              backgroundColor: ["rgba(12, 238, 106, 0.342)"],
              borderColor: ["rgba(12, 238, 106, 0.342)"],
              borderWidth: 1,
            },

            {
              label: "Y",
              data: [],
              backgroundColor: ["rgba(250, 45, 56, 0.603)"],
              borderColor: ["rgba(250, 45, 56, 0.603)"],
              borderWidth: 1,
            },
            {
              label: "Z",
              data: [],
              backgroundColor: ["rgba(14, 231, 231, 0.397)"],
              borderColor: ["rgba(14, 231, 231, 0.397)"],
              borderWidth: 1,
            },
          ],
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });

      function changeLine() {
        const updateType = "line";
        myChart.config.type = updateType;
        myChart.update();
      }

      function changeBar() {
        const updateType = "bar";
        myChart.config.type = updateType;
        myChart.update();
      }
      function changeBubble() {
        const updateType = "bubble";
        myChart.config.type = updateType;
        myChart.update();
      }
      function changePie() {
        const updateType = "pie";
        myChart.config.type = updateType;
        myChart.update();
      }
      function changeDoughnut() {
        const updateType = "doughnut";
        myChart.config.type = updateType;
        myChart.update();
      }
      function changePolar() {
        const updateType = "polarArea";
        myChart.config.type = updateType;
        myChart.update();
      }
      function changeRadar() {
        const updateType = "radar";
        myChart.config.type = updateType;
        myChart.update();
      }
    </script>
  </body>
</html>
